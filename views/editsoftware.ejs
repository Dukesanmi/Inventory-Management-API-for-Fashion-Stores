<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Update software project</title>
</head>
<style type="">
	section {
		margin: 0 0 0 9px;
	}
	h4 {
		font-size: 1.5rem;
	}
	button {
		padding: 5px 7px;
		cursor: pointer;
	}
	input, textarea {
		width: 30%;
	}
	textarea {
		height: 50px;
	}
	input[type=file]::file-selector-button {
		margin-top: 1em;
		outline: none;
		border: 1px solid lightgray;
		padding: 5px;
		background-color: lightgray;
		cursor: pointer;
	}
</style>
<body>
	<section>
    	<div class="form-container">
    		<div id="form-wrapper" class="card">
    			<h4 align="">Update software project</h4>
    			<form>
    				<label for="name" class="form-items">
    					<span class="form-title">Name</span><br>
    					<input type="text" name="name" id="name" class="input-field" placeholder="Project's Name" value="<%= software.name %>" required>
						<div id="name-error" class="name error"></div><br>
    				</label><br>
    				<label for="url" class="form-items">
    					<span class="form-title">Live URL</span><br>
    					<input type="text" name="live_url" id="url" class="input-field" placeholder="Project's live url" value="<%=software.live_url%>" required>
					</label><br><br>
					<label for="github" class="form-items">
    					<span class="form-title">Github URL</span><br>
    					<input type="text" name="github_url" id="github" class="input-field" placeholder="Project's github url" value="<%=software.github_url%>" required>
					</label><br><br>
					<label for="description" class="form-items">
    					<span class="form-title">Description</span><br>
    					<textarea name="description" id="description"><%=software.description%></textarea>
					</label><br><br>
    				<div class="btn-wrapper">
    					<button type="submit" value="save">Update software project</button>
    				</div>
    			</form>
    		</div>
    	</div>
    </section><br><br>
    <a href="/">Back home</a>
</body>
<script type="text/javascript">
	const log = console.log;
    const pagdata = JSON.parse('<%- JSON.stringify(software) %>');
    log(pagdata);
	const form = document.querySelector('form');
    const nameError = document.querySelector('.name.error');

    nameError.style.display = "none";
    log(form.description.value);

      
	// Update offering	

	form.addEventListener('submit', async (e) => {
    	e.preventDefault();

    	// reset errors
    	nameError.textContent = '';


    	// get values
    	const name = form.name.value;
    	const live_url = form.live_url.value;
    	const github_url = form.github.value;
    	const description = form.description.value;
    	const id = pagdata._id;
    
    	try {
      		const res = await fetch(`/edit_software/${id}`, { 
        		method: 'PATCH', 
        		body: JSON.stringify({ name, live_url, github_url, description, id }),
        		headers: {'Content-Type': 'application/json'}
      		});

      		const data = await res.json();

      		if (data.errors) {
        		nameError.textContent = data.errors.password;
    			nameError.style.display = "block";
      		}

			if (data.softwareSave) {
       	 		location.assign(`/edit_software_page/${id}`);
      		}

    	}
    	catch (err) {
      		return err;
    	}

  	});
 
</script>
</body>
</html>